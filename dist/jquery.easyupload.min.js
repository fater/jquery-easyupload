!function(e){var s={url:document.URL,data:{},max_file_size:0,file_name:"file",cancel_element:"",drop_element:"",on_max_file_size:function(e){},on_progress:function(e){},on_upload_before:function(e){},on_upload_file:function(e){},on_upload_finish:function(){},on_upload_error:function(e){},on_upload_cancel:function(e){}},o={files:{},all_files_size:0,uploaded_size:0,size:0,send_pos:0,sender_launched:!1},n=function(n,i){var l=this;l.element=e(n),l.options=e.extend({},s,i),l.process=e.extend({},o),l.element.on("change",function(s){l.process.cancelled&&(l.process=e.extend({},o)),l.queue(s.target.files)}),l.options.cancel_element&&""!=l.options.cancel_element&&e(l.options.cancel_element).on("click",function(e){return e.stopPropagation(),e.preventDefault(),l.process.cancelled=!0,!0})};n.prototype.queue=function(s){var o=this;e.each(s,function(e,s){return o.options.max_file_size>0&&s.size>o.options.max_file_size?(o.options.on_max_file_size(s),!0):(o.process.size++,o.process.files[o.process.size]=s,void(o.process.all_files_size+=s.size))}),0==o.process.sender_launched&&(o.options.on_upload_before({files:o.process.size,files_size:o.process.all_files_size}),o.process.sender_launched=!0,o.send())},n.prototype.send=function(){var s=this;if(s.process.cancelled)return null;if(s.process.send_pos>=s.process.size)return s.process=e.extend({},o),s.options.on_upload_finish(),null;s.process.send_pos++;var n=new FormData;n.append(s.options.file_name,s.process.files[s.process.send_pos]),e.each(s.options.data,function(e,s){n.append(e,s)}),e.ajax({url:s.options.url,type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1,complete:function(e){s.process.cancelled||(s.process.uploaded_size+=s.process.files[s.process.send_pos].size,s.send())},success:function(e){s.options.on_upload_file(e)},error:function(o){if(!s.process.cancelled){var n=s.process.files[s.process.send_pos].name;s.options.on_upload_error.call(this,e.extend(o,{file_name:n}))}},xhr:function(){var o=e.ajaxSettings.xhr();return o.upload.onprogress=function(e){s.process.cancelled&&(s.options.on_upload_cancel({file_name:s.process.files[s.process.send_pos].name}),o.abort());var n={};n.progress_file=e.loaded/e.total*100,n.progress_total=(s.process.uploaded_size+e.loaded)/s.process.all_files_size*100,n.progress_total=n.progress_total>100?100:n.progress_total,n.total_files=s.process.size,n.current_file=s.process.send_pos,s.options.on_progress(n)},o.upload.onload=function(){},o}})},e.fn.easyupload=function(e){this.each(function(){return new n(this,e)})}}(jQuery);