!function(e){var o={url:document.URL,data:{},max_file_size:0,file_name:"file",cancel_element:"",drop_element:"",on_max_file_size:function(e){},on_progress:function(e){},on_upload_before:function(e){},on_upload_file:function(e){},on_upload_finish:function(){},on_upload_error:function(e){},on_upload_cancel:function(e){}},s={files:{},all_files_size:0,uploaded_size:0,size:0,send_pos:0,sender_launched:!1},n=function(n,t){var i=this;i.element=e(n),i.options=e.extend({},o,t),i.process=e.extend({},s),i.element.on("change",function(o){i.process.cancelled&&(i.process=e.extend({},s)),i.queue(o.target.files)}),""!=i.options.drop_element&&e(i.options.drop_element).on("dragover",function(e){e.stopPropagation(),e.preventDefault()}).on("drop",function(e){e.preventDefault(),i.queue(e.originalEvent.dataTransfer.files)}),i.options.cancel_element&&""!=i.options.cancel_element&&e(i.options.cancel_element).on("click",function(e){return e.stopPropagation(),e.preventDefault(),i.process.cancelled=!0,!0})};n.prototype.queue=function(o){var s=this;e.each(o,function(e,o){return s.options.max_file_size>0&&o.size>s.options.max_file_size?(s.options.on_max_file_size(o),!0):(s.process.size++,s.process.files[s.process.size]=o,void(s.process.all_files_size+=o.size))}),0==s.process.sender_launched&&(s.options.on_upload_before({files_count:s.process.size,files_size:s.process.all_files_size}),s.process.sender_launched=!0,s.send())},n.prototype.send=function(){var o=this;if(o.process.cancelled)return null;if(o.process.send_pos>=o.process.size)return o.process=e.extend({},s),o.options.on_upload_finish(),null;o.process.send_pos++;var n=new FormData;n.append(o.options.file_name,o.process.files[o.process.send_pos]),e.each(o.options.data,function(e,o){n.append(e,o)}),e.ajax({url:o.options.url,type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1,complete:function(e){o.process.cancelled||(o.process.uploaded_size+=o.process.files[o.process.send_pos].size,o.send())},success:function(e){o.options.on_upload_file(e)},error:function(s){if(!o.process.cancelled){var n=o.process.files[o.process.send_pos].name;o.options.on_upload_error.call(this,e.extend(s,{file_name:n}))}},xhr:function(){var s=e.ajaxSettings.xhr();return s.upload.onprogress=function(e){o.process.cancelled&&(o.options.on_upload_cancel({file_name:o.process.files[o.process.send_pos].name}),s.abort());var n={};n.progress_file=e.loaded/e.total*100,n.progress_total=(o.process.uploaded_size+e.loaded)/o.process.all_files_size*100,n.progress_total=n.progress_total>100?100:n.progress_total,n.total_files=o.process.size,n.current_file=o.process.send_pos,o.options.on_progress(n)},s.upload.onload=function(){},s}})},e.fn.easyupload=function(e){this.each(function(){return new n(this,e)})}}(jQuery);